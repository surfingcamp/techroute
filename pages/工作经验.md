- 项目：做零售超市，门店是最重要组成部分，商品在门店销售 数据库查门店是压力最大的
	- 门店数据量很大查询很频繁
		- 第一版：先连表查后面改成单表查
			- 单表查询也要十几秒，门店数据很大 且是一个很大的接口
				- 一旦设计到很多改动这个接口就会改动量很大，没有全部改减少影响出现问题调用新的小接口。
		- 第二版：所以把数据存放到ES
			- 通过事务框架事务完成在监听机制那里发送MQ 另外一个服务接收MQ发送到ES
			  > 这样把MQ跟真正业务操作解耦了，如果MQ失败了不影响主线
			- 这样的话对ES压力很大
				- 批量查询ES
				- 单个查缓存 再查数据库
			- 商品数据本身更新频繁要频繁刷到ES这样ES就比较频繁，ES读的性能比较好但是写的性能不是很好
		- 出现问题
			- 调用搜索服务（搜索服务连接数不够用），运营直接连ES
			- 降低ES的依赖，增加缓存。添加商品直接添加到缓存里面，缓存预热（把重要数据刷）
			  > ES经常出问题经常报出哪些ES接口异常导致的
				- 批量的是用的ES：比如查询附近所有门店
				- 比如分页查询页面的就直接查询数据库
				- 商品一般根据门店编码去查所以通过redis也可以搞定
			- ES和数据库不一致
				- 定时把数据库同步到ES
					- 有一个全量脚本：如果没有的话就插入有的话就更新
					- 有一个根据时间做同步：把一天更新数据捞出来
				- 用户投诉：手动更新
			- 第二个
				- 很多调用门店服务导致门店服务不够用（调用对门店依赖）
					- A服务缓存：A服务调用门店服务，A本地缓存。拿到门店数据门店是旧的依然可以更新，他们自己存的时间比较短。
					- 门店自身服务：提升性能
					- 问：能不能rpc一步，订单调用门店后异步返回后面再异步通知订单。
- 积分操作：
	- 模板钩子
	- 策略